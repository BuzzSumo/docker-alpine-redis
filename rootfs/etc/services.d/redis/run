#!/usr/bin/with-contenv bash
set -e

# MAP UID/GID
USERMAP_UID=${USERMAP_UID:-redis}
USERMAP_GID=${USERMAP_GID:-redis}

if [[ $USERMAP_UID != *[[:digit:]]* ]]; then
	USERMAP_UID=$(id -u $USERMAP_UID)
fi

if [[ $USERMAP_GID != *[[:digit:]]* ]]; then
	USERMAP_GID=$(id -g $USERMAP_GID)
fi

exec s6-applyuidgid -u ${USERMAP_UID} -g ${USERMAP_GID} redis-server /etc/redis.conf